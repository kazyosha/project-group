<!DOCTYPE html>
<html lang="vi" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org" th:inline="text"
      layout:decorate="~{/layout}">
<head>
    <title>Danh s√°ch kh√°ch h√†ng</title>
    <meta name="_csrf" th:content="${_csrf.token}">
    <meta name="_csrf_header" th:content="${_csrf.headerName}">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</head>
<body class="container mt-5">
<section layout:fragment="content">
    <div class="card shadow p-4">
        <h3 class="mb-3">üìã Danh s√°ch kh√°ch h√†ng</h3>

        <div class="mb-3 d-flex gap-2">
            <a th:href="@{/admin/customers/create}" class="btn btn-primary">‚ûï Th√™m kh√°ch h√†ng</a>
            <a th:href="@{/admin/customers/deleted}" class="btn btn-danger">üóëÔ∏è Th√πng r√°c</a>
        </div>

        <input id="searchBox" type="text" class="form-control mb-3" placeholder="T√¨m theo t√™n ho·∫∑c m√£ KH...">

        <div class="table-responsive">
            <table class="table table-bordered table-striped align-middle">
                <thead class="table-dark text-center">
                <tr>
                    <th>ID</th>
                    <th>M√£ KH</th>
                    <th>T√™n</th>
                    <th>L·ªõp</th>
                    <th>ƒê·ªãa ch·ªâ</th>
                    <th>Ng√†y sinh</th>
                    <th class="text-center">H√†nh ƒë·ªông</th>
                </tr>
                </thead>
                <tbody id="customersBody">
                <tr th:each="c : ${customers}" class="text-center">
                    <td th:text="${c.id}"></td>
                    <td th:text="${c.code}"></td>
                    <td th:text="${c.name}"></td>
                    <td th:text="${c.schoolClass}"></td>
                    <td th:text="${c.address}"></td>
                    <td th:text="${c.birthDate}"></td>
                    <td class="text-center">
                        <a th:href="@{'/admin/customers/' + ${c.id} + '/edit'}" class="btn btn-sm btn-warning">‚úèÔ∏è S·ª≠a</a>
                        <a th:href="@{'/admin/customers/' + ${c.id} + '/delete'}"
                           class="btn btn-sm btn-danger"
                           onclick="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a kh√°ch h√†ng n√†y kh√¥ng?')">üóëÔ∏è X√≥a</a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <nav th:if="${customersPage.totalPages > 1}">
            <ul class="pagination justify-content-center">
                <!-- Previous -->
                <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled'">
                    <a class="page-link" th:href="@{/admin/customers(page=${currentPage - 1})}">¬´</a>
                </li>

                <!-- Page numbers -->
                <li class="page-item" th:each="i : ${#numbers.sequence(1, customersPage.totalPages)}"
                    th:classappend="${i == currentPage} ? 'active'">
                    <a class="page-link" th:href="@{/admin/customers(page=${i})}" th:text="${i}">1</a>
                </li>

                <!-- Next -->
                <li class="page-item" th:classappend="${currentPage == customersPage.totalPages} ? 'disabled'">
                    <a class="page-link" th:href="@{/admin/customers(page=${currentPage + 1})}">¬ª</a>
                </li>
            </ul>
        </nav>
    </div>

    <script>
        // T√¨m ki·∫øm nhanh theo t√™n ho·∫∑c m√£ KH
        document.addEventListener("DOMContentLoaded", function () {
            const searchBox = document.getElementById("searchBox");
            const tableBody = document.getElementById("customersBody");

            searchBox.addEventListener("input", function () {
                const filter = searchBox.value.toLowerCase();
                const rows = tableBody.querySelectorAll("tr");

                rows.forEach(row => {
                    const name = row.cells[2].textContent.toLowerCase();
                    const code = row.cells[1].textContent.toLowerCase();
                    row.style.display = (name.includes(filter) || code.includes(filter)) ? "" : "none";
                });
            });
        });
    </script>
</section>
</body>
</html>
